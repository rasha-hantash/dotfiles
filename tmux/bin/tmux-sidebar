#!/usr/bin/env bash
# Persistent sidebar showing all Claude Code session tabs

# Don't accept keyboard input in this pane
exec 0</dev/null

# Hide cursor
tput civis
trap 'tput cnorm' EXIT

SESSION=$(tmux display-message -p '#S')

while true; do
    # Move cursor to top-left and overwrite (no full clear = no blink)
    tput cup 0 0

    printf '\033[1;37m CC Session Tabs \033[0m\033[K\n'
    printf '───────────────────────\033[K\n'

    tmux list-windows -t "$SESSION" -F '#{window_index}|#{window_active}|#{window_name}' | \
    while IFS='|' read -r idx active name; do
        if [ "$active" = "1" ]; then
            printf ' \033[1;33m▶ %s  %s\033[0m\033[K\n' "$idx" "$name"
        else
            printf ' \033[90m  %s  %s\033[0m\033[K\n' "$idx" "$name"
        fi
    done

    printf '───────────────────────\033[K\n'
    printf '\033[90m C-a ↑/↓ switch\033[0m\033[K\n'

    # Clear any remaining lines from previous renders (e.g., after closing a session)
    printf '\033[J'

    sleep 1
done
